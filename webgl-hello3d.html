<html>

<head>
<title>WebGL Hello World (3D)</title>
<script src="gl-matrix.js"></script>
<script src="gl-matrix-inplace.js"></script>
<script src="common.js"></script>
<script type="text/javascript">
    var gl;
    var canvas;
    var shader = {};
    var displist = {};
    
    function draw() {
        mat4.translate_ip(shader.uniforms.modelview.value, [0.2, 0.3, 0]);
        shader.set_uniforms();
        displist.draw(function(){
            displist.begin(gl.TRIANGLES);
            displist.color(1, 0, 0);
            displist.vertex2(1, 0);
            displist.color(0, 1, 0);
            displist.vertex2(0, 1);
            displist.color(0, 0, 1);   
            displist.vertex2(0, 0);
            displist.end();
        });
    }
    function init() {
        canvas = document.getElementById("canvas");
        gl = canvas.getContext("experimental-webgl");
        gl.viewportWidth = canvas.width;
        gl.viewportHeight = canvas.height;
        if (!gl)
            alert("Could not initialise WebGL, sorry :-(");
        var vertex_shader_src = "\
            attribute vec3 a_position;\
            attribute vec3 a_color;\
            varying vec3 v_color;\
            uniform mat4 u_modelview;\
            uniform mat4 u_projection;\
            void main(void) {\
                gl_Position = u_projection * u_modelview * vec4(a_position, 1.0);\
                v_color = a_color;\
            }\
            ";
        var fragment_shader_src = "\
            precision mediump float;\
            varying vec3 v_color;\
            void main(void) {\
                gl_FragColor = vec4(v_color, 1.0);\
            }\
            ";
        shader = get_shader(gl, vertex_shader_src, fragment_shader_src);
        shader.add_uniform("modelview", "Matrix4f");
        shader.add_uniform("projection", "Matrix4f");
        
        displist = get_displist(gl, shader.program);
        displist.add_vertex_attribute("color", 3);
    }
</script>


</head>


<body onload="init();draw();">
    <canvas id="canvas" width="640" height="480"></canvas>
</body>

</html>
